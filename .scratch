import pandas as pd
import matplotlib.pyplot as plt
import io

# Sample log data (replace with your actual log file path)
log_data = """20250128 01:43:30,913#USD.CLIENT.ANALYTICS.INSTRUMENTS#428216000#13427
20250128 01:43:31,838#USD.FUTURE_PRICING.INSTRUMENT.ANALYTICS.FUTURE#428219000#12175
20250128 01:43:33,920#TBA.FACTORS.ANALYTICS.ALL.FUTURE#428229000#11175
20250128 01:43:37,234#USD.FUTURE_PRICING.INSTRUMENT.ANALYTICS.FUTURE#428259000#3175
20250128 01:48:30,913#USD.CLIENT.ANALYTICS.INSTRUMENTS#428316000#14427
20250128 01:48:31,838#USD.FUTURE_PRICING.INSTRUMENT.ANALYTICS.FUTURE#428319000#13175
20250128 01:48:33,920#TBA.FACTORS.ANALYTICS.ALL.FUTURE#428329000#12175
20250128 01:48:37,234#USD.FUTURE_PRICING.INSTRUMENT.ANALYTICS.FUTURE#428359000#4175"""

# ... (Data loading and preprocessing - same as before)

# Plotting with subplots
fig, axes = plt.subplots(len(df_resampled['chain_name'].unique()), 1, figsize=(12, 6 * len(df_resampled['chain_name'].unique())), sharex=True)  # sharex for common timeline

if not isinstance(axes, (list,)): # handles the case of single chain_name
    axes = [axes]

for i, chain in enumerate(df_resampled['chain_name'].unique()):
    chain_data = df_resampled[df_resampled['chain_name'] == chain]
    ax = axes[i]  # Get the correct subplot axis

    ax.plot(chain_data.index, chain_data['total_messages_added'], label='Total Messages Added')
    ax.plot(chain_data.index, chain_data['processed_messages'], label='Processed Messages')
    ax.plot(chain_data.index, chain_data['pending_messages'], label='Avg Pending Messages')

    ax.set_title(chain)  # Set title for each subplot
    ax.set_ylabel('Count')
    ax.legend()
    ax.grid(True)
    ax.tick_params(axis='x', rotation=45)  # Rotate x-axis labels
    ax.xaxis.set_major_locator(plt.AutoLocator()) # improve x axis ticks
    if i < len(df_resampled['chain_name'].unique()) -1:
        ax.set_xticklabels([]) # remove x ticks for other plots

plt.xlabel('Time')  # Common x-axis label
plt.tight_layout()
plt.subplots_adjust(hspace=0.3) # adjust space between subplots
plt.show()
