# Plotting with subplots (Corrected)
num_chains = len(df_resampled['chain_name'].unique())  # Store the number of chain names
fig, axes = plt.subplots(num_chains, 1, figsize=(12, 6 * num_chains), sharex=True)

# Handle the case where there's only one chain
if num_chains == 1:
    axes = [axes]  # Make axes a list so we can iterate

for i, chain in enumerate(df_resampled['chain_name'].unique()):
    chain_data = df_resampled[df_resampled['chain_name'] == chain]

    ax = axes[i]  # Correctly access the individual subplot axis

    ax.plot(chain_data.index, chain_data['total_messages_added'], label='Total Messages Added')
    ax.plot(chain_data.index, chain_data['processed_messages'], label='Processed Messages')
    ax.plot(chain_data.index, chain_data['pending_messages'], label='Avg Pending Messages')

    ax.set_title(chain)
    ax.set_ylabel('Count')
    ax.legend()
    ax.grid(True)
    ax.tick_params(axis='x', rotation=45)
    ax.xaxis.set_major_locator(plt.AutoLocator())

    if i < num_chains - 1:  # Corrected condition for hiding x-axis ticks
        ax.set_xticklabels([])

plt.xlabel('Time')
plt.tight_layout()
plt.subplots_adjust(hspace=0.3)
plt.show()
